{% extends 'base.html' %}
{% load static %}

{% block title %}Game - Captain America: The Last Stand{% endblock %}

{% block content %}
<div class="game-container">
    <!-- Game Stats -->
    <div class="game-stats">
        <div class="stat-item">
            <div class="stat-label">Hostage Timer</div>
            <div class="stat-value hostage-timer" id="hostage-timer">{{ game_session.hostage_timer|floatformat:0 }}</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Score</div>
            <div class="stat-value" id="score">{{ game_session.score }}</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Shield Cooldown</div>
            <div class="stat-value" id="shield-cooldown">Ready</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Status</div>
            <div class="stat-value" id="game-status">{{ game_session.status|title }}</div>
        </div>
    </div>

    <!-- Game Instructions -->
    <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 1rem; margin-bottom: 2rem; text-align: center;">
        <h3 style="color: #ffd700; margin-bottom: 0.5rem;">üéØ MISSION BRIEFING</h3>
        <p>Ultron is escaping through the maze! Place shields strategically to delay him while the hostages escape. You win when the timer reaches 0 and all hostages are safe!</p>
    </div>

    <!-- Main Game Area -->
    <div class="game-board-container">
        <!-- Game Board -->
        <div>
            <div id="game-board" class="game-board"></div>
            
            <!-- Game Controls -->
            <div class="game-controls">
                <button id="start-game" class="btn">Start New Game</button>
            </div>
        </div>

        <!-- Shield Controls -->
        <div class="shield-controls">
            <h3>üõ°Ô∏è Shield Arsenal</h3>
            
            <div class="shield-type selected" data-shield-type="blue">
                <div class="shield-icon blue"></div>
                <div class="shield-info">
                    <h4>Full Block Shield</h4>
                    <p>Completely blocks Ultron's path. Forces him to find alternate routes.</p>
                </div>
            </div>
            
            <div class="shield-type" data-shield-type="yellow">
                <div class="shield-icon yellow"></div>
                <div class="shield-info">
                    <h4>Timer Reduction Shield</h4>
                    <p>Reduces hostage timer by 2 seconds when Ultron passes through. Use strategically!</p>
                </div>
            </div>
            
            <div class="shield-type" data-shield-type="red">
                <div class="shield-icon red"></div>
                <div class="shield-info">
                    <h4>Pause Shield</h4>
                    <p>Pauses Ultron's movement for 4 seconds when he passes through.</p>
                </div>
            </div>
            
            <div style="margin-top: 2rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px;">
                <h4 style="color: #ffd700;">üìã How to Play:</h4>
                <ul style="margin-top: 0.5rem; font-size: 0.9rem;">
                    <li>Click on grid tiles to place shields</li>
                    <li>Shield placement has a 4-second cooldown</li>
                    <li>Ultron moves 1 tile per second</li>
                    <li>Win by surviving until hostages escape (timer reaches 0)</li>
                    <li>Lose if Ultron reaches the exit before timer expires</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 1rem; margin-top: 2rem;">
        <h3 style="color: #ffd700; text-align: center; margin-bottom: 1rem;">üó∫Ô∏è LEGEND</h3>
        <div style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div style="width: 20px; height: 20px; background: #cc0000; border-radius: 2px;"></div>
                <span>ü§ñ Ultron</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div style="width: 20px; height: 20px; background: #ffd700; border-radius: 2px;"></div>
                <span>üö™ Exit</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div style="width: 20px; height: 20px; background: #1e90ff; border-radius: 2px;"></div>
                <span>üõ°Ô∏è Blue Shield</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div style="width: 20px; height: 20px; background: #ffd700; border-radius: 2px;"></div>
                <span>üõ°Ô∏è Yellow Shield</span>
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div style="width: 20px; height: 20px; background: #ff4444; border-radius: 2px;"></div>
                <span>üõ°Ô∏è Red Shield</span>
            </div>
        </div>
    </div>
</div>
    
    <!-- Tutorial Popup Modal -->
    <div id="tutorial-modal" style="display: {% if show_tutorial %}flex{% else %}none{% endif %}; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center;">
        <div style="background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); padding: 3rem; border-radius: 20px; max-width: 600px; box-shadow: 0 0 50px rgba(255,215,0,0.5);">
            <h2 style="color: #ffd700; text-align: center; margin-bottom: 1.5rem; font-size: 2rem;">üõ°Ô∏è WELCOME, AGENT!</h2>
            
            <div style="background: rgba(0,0,0,0.5); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                <h3 style="color: #ffd700; margin-bottom: 1rem;">üéØ Your Mission:</h3>
                <p style="margin-bottom: 1rem;">Ultron is escaping! Delay him while hostages evacuate. You win when the timer reaches 0.</p>
                
                <h3 style="color: #ffd700; margin-bottom: 1rem;">üõ°Ô∏è Shield Arsenal:</h3>
                <ul style="margin-left: 1.5rem; margin-bottom: 1rem;">
                    <li><strong style="color: #1e90ff;">Blue Shield:</strong> Blocks Ultron completely - forces him to find another path</li>
                    <li><strong style="color: #ffd700;">Yellow Shield:</strong> Reduces timer by 2 seconds when Ultron passes through</li>
                    <li><strong style="color: #ff4444;">Red Shield:</strong> Pauses Ultron for 4 seconds</li>
                </ul>
                
                <h3 style="color: #ffd700; margin-bottom: 1rem;">üìã Game Rules:</h3>
                <ul style="margin-left: 1.5rem;">
                    <li>Click "Start New Game" to begin</li>
                    <li>Click tiles to place shields (4-second cooldown)</li>
                    <li>Ultron moves 1 tile per second</li>
                    <li><strong style="color: #00ff00;">WIN:</strong> Survive 40 seconds (timer reaches 0) = 1000 points!</li>
                    <li><strong style="color: #ff4444;">LOSE:</strong> If Ultron reaches the red exit</li>
                </ul>
            </div>
            
            <button onclick="document.getElementById('tutorial-modal').style.display='none'" class="btn" style="width: 100%; font-size: 1.2rem; padding: 1rem;">
                üöÄ START MY MISSION!
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    window.gameId = {{ game_session.id|default:1 }};
</script>
{% endblock %}
